ACC.countdown = {

    _autoload: [
        ["loadTimerCards", $(".timer-card").length > 0]
    ],

    loadTimerCards: function () {
        $(".timer-card").each(function () {
            ACC.countdown.updateCounter($(this));
        });
    },

    updateCounter: function (timerCard) {
        if (timerCard.length > 0) {
            const dataProgress = timerCard.data("progress");
            const dataTimeLeft = timerCard.data("timeleft");

            const $logo = timerCard.find(".timer-card__circle__logo");
            const $countDown = timerCard.find(".timer-card__count-down");
            const $progress = timerCard.find(".timer-card__progress");
            const $progressFill = $progress.find(".timer-card__progress__fill");

            const boxSize = $progress.width();
            const strokeWidth = parseInt($progressFill.css('stroke-width'), 10);
            const circleRadius = boxSize / 2 - strokeWidth;
            const alpha = 2 * (Math.PI) * (1 - dataProgress);
            const left = boxSize / 2 - circleRadius * Math.cos(alpha - 0.5 * Math.PI);
            const top = boxSize / 2 + circleRadius * Math.sin(alpha - 0.5 * Math.PI);

            const length = $progressFill[0].getTotalLength();
            const strokeDashoffset = length * dataProgress;
            $progressFill.css("stroke-dashoffset", -strokeDashoffset + "px");

            setTimeout(function () {
                $logo.css({
                    'top': top + 'px',
                    'left': left + 'px',
                    'opacity': '1'
                });
            }, 1000);

            if ($countDown.length) {
                const $time = $countDown.find(".time");
                const splitDataTimeLeft = dataTimeLeft.split(":");
                let hours = parseInt(splitDataTimeLeft[0]);
                let minutes = parseInt(splitDataTimeLeft[1]);

                setInterval(function () {
                    if (minutes > 0) {
                        minutes--;
                    } else {
                        if (hours > 0) {
                            hours--;
                            minutes = 59;
                        }
                    }

                    let hoursText = hours > 9 ? hours : "0" + hours;
                    let minutesText = minutes > 9 ? minutes : "0" + minutes;
                    $time.html(hoursText + ":" + minutesText);
                }, 60000);
            }
        }
    }

};
