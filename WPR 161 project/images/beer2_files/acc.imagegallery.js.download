ACC.imagegallery = {

    _autoload: [
        "bindImageGallery"
    ],

    bindImageGallery: function () {
        $(".js-gallery").each(function () {
            const $image = $(this).find(".js-gallery-image");
            const $carousel = $(this).find(".js-gallery-carousel");

            $image.owlCarousel({
                singleItem: true,
                pagination: true,
                navigation: true,
                lazyLoad: true,
                navigationText: [$("<span>").addClass("glyphicon glyphicon-chevron-left"), $("<span>").addClass("glyphicon glyphicon-chevron-right")],
                afterAction: function () {
                    ACC.imagegallery.syncPosition($image, $carousel, this.currentItem);
                    $image.data("zoomEnable", true);
                },
                startDragging: function () {
                    $image.data("zoomEnable", false);
                },
                afterLazyLoad: function () {
                    const b = $image.data("owlCarousel") || {};
                    if (!b.currentItem) {
                        b.currentItem = 0;
                    }
                    const $e = $($image.find("img.lazyOwl")[b.currentItem]);
                    startZoom($e.parent());
                }
            });

            $carousel.owlCarousel({
                navigation: true,
                navigationText: [$("<span>").addClass("glyphicon glyphicon-chevron-left"), $("<span>").addClass("glyphicon glyphicon-chevron-right")],
                pagination: false,
                items: 2,
                itemsDesktop: [1920, 7],
                itemsDesktopSmall: [1280, 5],
                itemsTablet: [1024, 4],
                itemsMobile: [636, 3],
                lazyLoad: true
            });

            $carousel.on("click", "a.item", function (e) {
                e.preventDefault();
                $image.trigger("owl.goTo", $(this).parent(".owl-item").data("owlItem"));
            });

            function startZoom(e) {
                $(e).zoom({
                    url: $(e).find("img.lazyOwl").data("zoomImage"),
                    touch: true,
                    on: "grab",
                    touchduration: 300,
                    onZoomOut: function () {
                        const owl = $image.data('owlCarousel');
                        owl.dragging(true);
                        $image.data("zoomEnable", true);
                    },
                    zoomEnableCallBack: function () {
                        const bool = $image.data("zoomEnable");
                        const owl = $image.data('owlCarousel');

                        if (bool === false) {
                            owl.dragging(true);
                        } else {
                            owl.dragging(false);
                        }
                        return bool;
                    }
                });
            }
        });
    },

    syncPosition: function ($image, $carousel, currentItem) {
        $carousel.trigger("owl.goTo", currentItem);
    }
};