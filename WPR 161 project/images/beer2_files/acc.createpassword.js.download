ACC.createpassword = {
    _autoload: [
        ["isValidPassword", $(".js-validate-password").length],
        ["bindPostCreatePassword", $(".set-password-submit").length],
        ["bindResendEmail", $("#createPasswordResendEmailForm").length],
        ["bindPostStoreAndInterests", $(".set-password-submit").length]
    ],

    bindPostCreatePassword: function () {
        $(document).on("click", ".set-password-submit", function (e) {
            const $form = $("#shrSetPasswordForm");
            e.preventDefault();

            const url = $form.attr("action");
            const formData = $form.serialize();

            $(".loading-background").show();
            $.ajax({
                url: url,
                type: "POST",
                data: formData,
                success: function (response) {
                    $(".loading-background").hide();

                    const $response = $(response);
                    if ($response.hasClass("js-ajax-redirect")) {
                        window.location.href = $response.data("redirectUrl");
                    } else {
                        $(".js-register-form-section__block").html($response);

                        ACC.global.loadActionsForm();
                        ACC.register.handleInterestClicks();
                        ACC.storefinder.showStoreResults();
                        ACC.storefinder.bindFindStoreNearMe();
                        ACC.storefinder.storeFinderInputState();
                    }
                }
            });
        });
    },

    isValidPassword: function () {
        $(document).on("input", ".js-validate-password", function (event) {
            let $formSubmitBtn = "";

            if ($(".set-password-submit").length) {
                $formSubmitBtn = $(".set-password-submit");
            } else if ($(".set-forgotten-password-submit").length) {
                $formSubmitBtn = $(".set-forgotten-password-submit");
            }

            if ($formSubmitBtn !== "") {
                const $errorSelector = $("#pwd-error");
                const value = $(event.currentTarget).val();

                if (ACC.validations.isValidPassword(value)) {
                    $errorSelector.hide();
                    $formSubmitBtn.attr("disabled", false);
                } else {
                    $errorSelector.text(loc("generic.invalid.password"));
                    $formSubmitBtn.attr("disabled", true);
                }
            }
        });
    },

    bindResendEmail: function () {
        $(document).on("click", ".js-resend-email", function (e) {
            e.preventDefault();

            const $form = $("#createPasswordResendEmailForm");
            $form.submit();
        });
    },

    bindPostStoreAndInterests: function () {
        $(document).on("click", ".js-create-password-submit", function (e) {
            e.preventDefault();

            const $form = $("#shrRegisterForm");
            const url = $form.attr("action");

            ACC.global.showLoadingBackgroundMenu();
            $.ajax({
                url: url,
                type: "POST",
                dataType: 'html',
                contentType: 'application/json',
                mimeType: 'application/json',
                data: JSON.stringify({
                    'preferences': ACC.register.interests,
                    'preferredStore': $form.find('#preferredStore').val()
                }),
                success: function (response) {
                    $(".loading-background").hide();

                    const $response = $(response);
                    if ($response.hasClass("js-ajax-redirect")) {
                        window.location.href = $response.data("redirectUrl");
                    } else {
                        $(".js-register-form-section__block").html($response);

                        if ($response.find("#preferredStore").length > 0) {
                            ACC.global.loadActionsForm();
                            ACC.global.loadInputEffect();
                            ACC.register.validateRegister();
                            ACC.storefinder.showStoreResults();
                            ACC.storefinder.bindFindStoreNearMe();
                            ACC.storefinder.storeFinderInputState();
                        } else {
                            ACC.global.jsCountdown();
                            ACC.register.gaEventsTriggers();
                        }
                    }
                }
            });
        });
    }

};
