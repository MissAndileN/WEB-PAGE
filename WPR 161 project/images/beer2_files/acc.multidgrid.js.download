ACC.multidgrid = {

    populateAndShowGridOverlay: function (element, event) {
        event.preventDefault();
        const itemIndex = $(element).data("index");
        const gridEntries = $(document).find('#grid' + itemIndex);

        const strSubEntries = gridEntries.data("sub-entries");
        const productName = gridEntries.data("product-name");
        const arrSubEntries = strSubEntries.split(',');
        const firstVariantCode = arrSubEntries[0].split(':')[0];

        const targetUrl = gridEntries.data("target-url") + '?productCode=' + encodeURIComponent(firstVariantCode);

        ACC.colorbox.open(ACC.common.encodeHtml(productName), {
            href: targetUrl,
            className: 'read-only-grid',
            close: '<span class="glyphicon glyphicon-remove"></span>',
            width: window.innerWidth > parseInt(cboxOptions.maxWidth) ? cboxOptions.maxWidth : cboxOptions.width,
            height: window.innerHeight > parseInt(cboxOptions.maxHeight) ? cboxOptions.maxHeight : cboxOptions.height,
            onComplete: function () {
            	const $cboxLoadedContent = $('#cboxLoadedContent');
                $('body').addClass('offcanvas');
                const oH = $cboxLoadedContent.height();
                $cboxLoadedContent.height((oH - $('#cboxTitle').height()) + 'px');
            },
            onClosed: function () {
                $('body').removeClass('offcanvas');
            }
        });
    },

    populateAndShowGrid: function (element) {
        const itemIndex = $(element).data("index");
        const grid = $(document).find("#ajaxGrid" + itemIndex);
        const gridEntries = $(document).find('#grid' + itemIndex);

        $(element).toggleClass('open');

        if (!grid.is(":hidden")) {
            grid.slideUp();
            return;
        }

        if (grid.html() !== "") {
            grid.slideToggle("slow");
            return;
        }

        const strSubEntries = gridEntries.data("sub-entries");
        const arrSubEntries = strSubEntries.split(',');
        const firstVariantCode = arrSubEntries[0].split(':')[0];

        $.ajax({
            url: gridEntries.data("target-url"),
            data: {productCode: firstVariantCode},
            type: "GET",
            dataType: 'html',
            success: function (data) {
                grid.html(data);
                grid.slideDown("slow");
            },
            error: function (xht, textStatus, ex) {
                console.log("Failed to get variant matrix. Error details [" + xht + ", " + textStatus + ", " + ex + "]");
            }
        });
    }

};