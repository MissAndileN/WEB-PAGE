ACC.resetpassword = {

    _autoload: [
        ["bindResetPasswordFormValidation", $("#shrResetPasswordForm").length],
        ["bindBackArrowClick", $(".js-reset-password-back-arrow").length > 0],
        ["bindNavigateToForgotPassword", $(".js-reset-password-to-forgotten-password").length > 0]
    ],

    loadPageViaAjax: function (targetUrl) {
        ACC.global.showLoadingBackgroundMenu();
        $.ajax({
            type: "POST",
            url: targetUrl,
            data: $("#shrResetPasswordForm").serialize(),
            success: function (data) {
                $(".loading-background").hide();
                if ($(data).hasClass("js-ajax-redirect")) {
                    window.location.href = $(data).data("redirectUrl");
                } else {
                    if ($(data).hasClass("js-reset-password-section")) {
                        $(".js-reset-password-section").replaceWith(data);
                        ACC.resetpassword.loadCommonBindings();
                    }
                }
            }
        });
    },

    bindBackArrowClick: function () {
        $(document).on("click", ".js-reset-password-back-arrow", function (e) {
            e.preventDefault();
            const backUrlAjax = $(".js-reset-password-section").data("backUrlAjax");
            if (backUrlAjax) {
                ACC.resetpassword.loadPageViaAjax(backUrlAjax);
            } else {
                window.location.href = $(this).attr("href");
            }
        });
    },

    bindResetPasswordFormValidation: function () {
        $.validator.addMethod("passwordGuidelines", function (value, element) {
            return this.optional(element) || ACC.validations.isValidPassword(value);
        }, loc("generic.invalid.password"));

        const resetPasswordForm = $("#shrResetPasswordForm");

        if (resetPasswordForm.length > 0) {
            resetPasswordForm.validate({
                ignore: '.not-active',
                errorElement: 'span',
                errorClass: 'sr-error',
                rules: {
                    pwd: {
                        required: true,
                        minlength: 8,
                        maxlength: 128
                    },
                    newPwd: {
                        required: true,
                        passwordGuidelines: true
                    },
                    newPwdCheck: {
                        required: true,
                        passwordGuidelines: true
                    }
                },
                errorPlacement: function (error, element) {
                    element.parent().append(error);
                },
                onkeyup: function () {
                    ACC.validations.validateForm(resetPasswordForm);
                },
                onfocusout: function (element) {
                    this.element(element);
                },
                submitHandler: function () {
                    ACC.resetpassword.loadPageViaAjax(resetPasswordForm.attr("action"));
                }
            });
        }
    },

    bindNavigateToForgotPassword() {
        $(document).on("click", ".js-reset-password-to-forgotten-password", function (e) {
            e.preventDefault();
            $("#js-reset-password-to-forgotten-password-form").submit();
        });
    },

    loadCommonBindings: function () {
        ACC.resetpassword.bindResetPasswordFormValidation();
        ACC.global.loadActionsForm();
        ACC.global.loadInputEffect();
    }

};
